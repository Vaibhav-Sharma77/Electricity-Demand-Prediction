{% extends "base_optimized.html" %}

{% block title %}PowerPulse Enhanced - Dashboard{% endblock %}

{% block content %}
<div class="row">
    <!-- Hero Section -->
    <div class="col-12 mb-4">
        <div class="card text-center">
            <div class="card-body p-5">
                <h1 class="display-4 mb-3">
                    <i class="fas fa-bolt text-primary"></i>
                    PowerPulse Enhanced
                </h1>
                <p class="lead mb-4">
                    Advanced AI-powered electricity demand forecasting for Delhi
                </p>
                <div class="row justify-content-center">
                    <div class="col-md-8">
                        <p class="text-muted">
                            Get accurate 24-hour electricity demand predictions using machine learning models 
                            trained on historical data and real-time weather conditions.
                        </p>
                    </div>
                </div>
                <a href="{{ url_for('forecast') }}" class="btn btn-primary btn-lg mt-3">
                    <i class="fas fa-chart-line"></i> Start Forecasting
                </a>
            </div>
        </div>
    </div>

    <!-- Current Weather Card -->
    {% if current_weather %}
    <div class="col-lg-4 mb-4">
        <div class="card weather-card h-100">
            <div class="card-body text-center">
                <div class="weather-icon">
                    <i class="fas fa-sun"></i>
                </div>
                <h3 class="card-title">Current Weather</h3>
                <h2 class="display-6 mb-3">{{ current_weather.temperature }}Â°C</h2>
                <div class="row">
                    <div class="col-6">
                        <div class="d-flex align-items-center justify-content-center">
                            <i class="fas fa-tint me-2"></i>
                            <span>{{ current_weather.humidity }}%</span>
                        </div>
                        <small class="text-light">Humidity</small>
                    </div>
                    <div class="col-6">
                        <div class="d-flex align-items-center justify-content-center">
                            <i class="fas fa-wind me-2"></i>
                            <span>{{ current_weather.wind_speed }} km/h</span>
                        </div>
                        <small class="text-light">Wind</small>
                    </div>
                </div>
                <small class="text-light mt-2 d-block">
                    <i class="fas fa-clock"></i> 
                    {{ current_weather.time }}
                </small>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Quick Stats -->
    <div class="col-lg-8 mb-4">
        <div class="card h-100">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-chart-bar text-primary"></i>
                    System Overview
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 col-6 mb-3">
                        <div class="stat-card">
                            <div class="stat-number">{{ regions|length }}</div>
                            <div class="stat-label">Regions</div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                        <div class="stat-card">
                            <div class="stat-number">3</div>
                            <div class="stat-label">AI Models</div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                        <div class="stat-card">
                            <div class="stat-number">24h</div>
                            <div class="stat-label">Forecast</div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                        <div class="stat-card">
                            <div class="stat-number">95%</div>
                            <div class="stat-label">Accuracy</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Available Regions -->
    <div class="col-12 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-map-marker-alt text-primary"></i>
                    Available Regions
                </h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    {% for region in regions %}
                    <div class="col-lg-2 col-md-4 col-6">
                        <div class="card text-center h-100 region-card" onclick="selectRegion('{{ region }}')">
                            <div class="card-body">
                                <i class="fas fa-building fa-2x text-primary mb-2"></i>
                                <h6 class="card-title">{{ region }}</h6>
                                <small class="text-muted">Delhi Region</small>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Features Section -->
    <div class="col-12 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-star text-primary"></i>
                    Key Features
                </h5>
            </div>
            <div class="card-body">
                <div class="row g-4">
                    <div class="col-lg-3 col-md-6">
                        <div class="text-center">
                            <div class="feature-icon mb-3">
                                <i class="fas fa-brain fa-3x text-primary"></i>
                            </div>
                            <h6>AI-Powered Predictions</h6>
                            <p class="text-muted small">
                                Advanced ensemble of Random Forest, LSTM, and XGBoost models
                            </p>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <div class="text-center">
                            <div class="feature-icon mb-3">
                                <i class="fas fa-cloud-sun fa-3x text-success"></i>
                            </div>
                            <h6>Real-time Weather</h6>
                            <p class="text-muted small">
                                Live weather data integration with intelligent fallbacks
                            </p>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <div class="text-center">
                            <div class="feature-icon mb-3">
                                <i class="fas fa-tachometer-alt fa-3x text-warning"></i>
                            </div>
                            <h6>Lightning Fast</h6>
                            <p class="text-muted small">
                                Optimized caching and lazy loading for instant results
                            </p>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <div class="text-center">
                            <div class="feature-icon mb-3">
                                <i class="fas fa-chart-line fa-3x text-info"></i>
                            </div>
                            <h6>Beautiful Visualizations</h6>
                            <p class="text-muted small">
                                Interactive charts and graphs for better insights
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Forecast -->
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-zap text-primary"></i>
                    Quick Forecast
                </h5>
            </div>
            <div class="card-body">
                <form id="quickForecastForm">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label">Region</label>
                            <select class="form-select" id="quickRegion" required>
                                {% for region in regions %}
                                <option value="{{ region }}">{{ region }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Date</label>
                            <input type="date" class="form-control" id="quickDate" 
                                   value="{{ today }}" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">&nbsp;</label>
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-search"></i> Quick Forecast
                            </button>
                        </div>
                    </div>
                </form>
                
                <div id="quickResults" class="mt-4" style="display: none;">
                    <div class="alert alert-info">
                        <div id="quickResultsContent"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.region-card {
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.region-card:hover {
    border-color: var(--primary-color);
    transform: translateY(-3px);
    box-shadow: var(--shadow-lg);
}

.feature-icon {
    height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.weather-card {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
}
</style>
{% endblock %}

{% block scripts %}
<script>
function selectRegion(region) {
    document.getElementById('quickRegion').value = region;
    showToast('success', `Selected region: ${region}`);
}

document.getElementById('quickForecastForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const region = document.getElementById('quickRegion').value;
    const date = document.getElementById('quickDate').value;
    const resultsDiv = document.getElementById('quickResults');
    const contentDiv = document.getElementById('quickResultsContent');
    
    // Show loading
    contentDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating forecast...';
    resultsDiv.style.display = 'block';
    
    // Make API call
    fetch('/api/forecast', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            region: region,
            date: date
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            contentDiv.innerHTML = `
                <h6><i class="fas fa-chart-line"></i> Forecast for ${region} - ${date}</h6>
                <div class="row mt-3">
                    <div class="col-md-3">
                        <strong>Peak Demand:</strong><br>
                        <span class="text-primary">${data.summary.peak_demand} MW</span>
                    </div>
                    <div class="col-md-3">
                        <strong>Peak Hour:</strong><br>
                        <span class="text-success">${data.summary.peak_hour}:00</span>
                    </div>
                    <div class="col-md-3">
                        <strong>Daily Total:</strong><br>
                        <span class="text-info">${data.summary.total_daily_demand} MWh</span>
                    </div>
                    <div class="col-md-3">
                        <strong>Confidence:</strong><br>
                        <span class="text-warning">${data.summary.average_confidence}%</span>
                    </div>
                </div>
                <div class="mt-3">
                    <a href="/forecast" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-chart-bar"></i> View Detailed Analysis
                    </a>
                </div>
            `;
        } else {
            contentDiv.innerHTML = `
                <div class="text-danger">
                    <i class="fas fa-exclamation-triangle"></i> 
                    Error: ${data.error}
                </div>
            `;
        }
    })
    .catch(error => {
        contentDiv.innerHTML = `
            <div class="text-danger">
                <i class="fas fa-exclamation-triangle"></i> 
                Network error. Please try again.
            </div>
        `;
    });
});
</script>
{% endblock %}
